<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Pro Tracker 1.0</title>
<style>
  :root{
    --bg:#0d1117; --card:#0f1520; --line:#1d2635; --text:#e6edf3; --muted:#9fb0c0;
    --ok:#1cd16f; --bad:#ff6b6b; --link:#9ad1ff; --highlight:#fff49a;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,"PingFang SC",sans-serif;}
  a{color:var(--link);text-decoration:none}
  a:hover{opacity:.9}

  /* 顶部 */
  .bar{padding:14px 16px 6px}
  .bar h1{margin:0 0 10px;font-size:26px;color:#caffd7}
  .ctrl{display:flex;gap:8px;align-items:center;margin-bottom:6px}
  .ctrl input,.ctrl select,.ctrl button{
    background:#0b1016;border:1px solid var(--line);color:var(--text);border-radius:8px;padding:6px 8px;font-size:13px
  }
  .hint{color:var(--muted);font-size:12px}

  /* 网格：限制每行最多 N 列 */
  .grid{display:grid;gap:10px;padding:10px 10px 18px;
        grid-template-columns: repeat(var(--max-cols), minmax(320px,1fr))}
  @media (max-width:1600px){ .grid{grid-template-columns: repeat(4, minmax(300px,1fr));} }
  @media (max-width:1300px){ .grid{grid-template-columns: repeat(3, minmax(300px,1fr));} }
  @media (max-width:980px) { .grid{grid-template-columns: repeat(2, minmax(280px,1fr));} }
  @media (max-width:680px) { .grid{grid-template-columns: repeat(1, minmax(260px,1fr));} }

  /* 卡片 */
  .card{background:var(--card);border:1px solid var(--line);border-radius:10px;overflow:hidden}
  .head{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-bottom:1px solid var(--line)}
  .head h2{margin:0;font-size:15px}
  .faceit{font-size:12px;border:1px solid var(--line);padding:4px 8px;border-radius:8px}

  /* 表格：紧凑 + 单行显示 */
  table{width:100%;border-collapse:collapse;table-layout:fixed}
  thead th{font-size:12px;color:#a7b6c7;text-align:left;padding:6px 8px;border-bottom:1px solid var(--line);white-space:nowrap}
  tbody td{padding:6px 8px;border-bottom:1px solid var(--line);vertical-align:middle;white-space:nowrap}

  /* 列宽与左对齐（更紧凑） */
  .c-date{width:30%}
  .c-score{width:10%}
  .c-map{width:10%; text-align:center;}   /* Map 图标只要 10% 宽度 */
  .c-kad{width:14%;}                      /* 给 K/A/D 多点空间 */
  .c-rating{width:10%;}                    /* Rating 靠左 */


  .win{color:var(--ok);font-weight:700}
  .loss{color:var(--bad);font-weight:700}

  .map-icon{
  width:16px;
  height:16px;
  border-radius:3px;
  vertical-align:-3px;
  margin:0 10px 0 6px; /* 左边 6px，右边 10px，让图标和文字更远 */
  object-fit:cover;
}


  /* 五杀高亮：除 score 外的整行文字提亮 */
  tr.highlight td:not(.c-score){ color: var(--highlight); }

  .foot{padding:8px 12px;color:var(--muted);font-size:12px;text-align:center}
</style>
</head>
<body>

  <div class="bar">
    <h1>Pro Tracker 1.0</h1>
    <form class="ctrl" method="get" action="/">
      <input type="text" name="players" value="{{ query_players }}" placeholder="玩家昵称，逗号分隔"
       style="width:60%;min-width:320px;max-width:900px;padding:8px 12px;font-size:14px;border-radius:8px;border:1px solid var(--line);background:#0b1016;color:var(--text);">
      <select name="limit">
        {% for n in [3,5,10,15,20] %}
          <option value="{{n}}" {% if limit==n %}selected{% endif %}>每人 {{n}} 场</option>
        {% endfor %}
      </select>
      <button type="submit">刷新数据</button>
    </form>
    <div class="hint">提示：Score 颜色表示胜负；时间为选手本地时间；Map 显示地图小图 + 名称；有五杀会高亮。</div>
  </div>

  <main class="grid" style="--max-cols: {{ max_cols }};">
    {% for p in panels %}
    <section class="card">
      <div class="head">
        <h2>{{ p.nickname }}</h2>
        <a class="faceit" href="{{ p.faceit_url }}" target="_blank">Faceit</a>
      </div>

      <table>
        <thead>
          <tr>
            <th class="c-date">Date</th>
            <th class="c-score">Score</th>
            <th class="c-map">Map</th>
            <th class="c-kad">K/A/D</th>
            <th class="c-rating">Rating</th>
          </tr>
        </thead>
        <tbody>
          {% for m in p.matches %}
          <tr class="{% if m.highlight %}highlight{% endif %}">
            <td class="c-date"><a href="{{ m.match_link }}" target="_blank">{{ m.date }}</a></td>
            <td class="c-score {{ m.result_class }}">{{ m.score }}</td>
            <td class="c-map">
              <img class="map-icon" src="{{ m.map_img }}" alt="">
            </td>
            <td class="c-kad">{{ m.k }}/{{ m.a }}/{{ m.d }}</td>
            <td class="c-rating">{{ m.rating }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>
    {% endfor %}
  </main>

  <div class="foot">Pro Tracker 1.0 · v{{ app_version }}</div>
</body>
</html>
